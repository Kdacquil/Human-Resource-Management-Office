import{a as _t,b as C,c as gt,d as bt,f as yt,g as Rt,h as Et,i as wt,j as Tt,k as kt,l as St,n as It,r as Ft}from"./chunk-2YXRKEKG.js";import{$ as ct,A as ot,B as at,D as M,E as z,Fa as Ct,Ga as Pt,Ha as At,I as Pe,Ia as De,Ja as Me,K as G,Ka as Nt,La as Dt,M as h,Ma as Mt,N as u,O as V,Oa as Lt,R as lt,S as he,Sa as W,T as Ae,Y as f,a as Je,aa as ut,ba as dt,c as re,ca as ht,d as xe,da as ft,e as et,g as tt,j as Oe,m as F,n as Ue,o as ie,p as S,q as nt,r as Ce,ra as pt,sa as mt,u as rt,v as it,y as st}from"./chunk-IP4MSLQ3.js";import{a as ue,b as de,d as v,k as vt,o as xt,r as L,s as fe,v as Ot,w as Ut,y as Ne,z as pe}from"./chunk-U3NIYLHF.js";var qt=(()=>{class e{constructor(n){this.firestore=n}getEmployees(){return this.firestore.collection("employees").valueChanges({idField:"id"})}saveOffboardingData(n,r){return v(this,null,function*(){try{yield this.firestore.collection("offboarding").doc(n).set(de(ue({},r),{timestamp:new Date})),yield this.firestore.collection("employees").doc(n).update({status:"Offboarded",offboardingDate:new Date}),console.log(`\u2705 Employee ${r.employeeName} successfully offboarded!`)}catch(i){throw console.error("\u274C Offboarding Error:",i),i}})}static{this.\u0275fac=function(r){return new(r||e)(S(W))}}static{this.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function vn(e,t){if(e&1){let n=lt();h(0,"li",28),he("click",function(){let i=rt(n).$implicit,s=Ae(2);return it(s.selectEmployee(i))}),f(1),u()}if(e&2){let n=t.$implicit;M(),ut(" ",n.lastname,", ",n.firstname," (ID: ",n.id,") ")}}function xn(e,t){if(e&1&&(h(0,"ul",29),Pe(1,vn,2,3,"li",30),u()),e&2){let n=Ae();M(),G("ngForOf",n.filteredEmployees)}}var ri=(()=>{class e{constructor(n,r,i,s){this.fb=n,this.offboardService=r,this.firestore=i,this.auditLogService=s,this.searchQuery="",this.filteredEmployees=[],this.employees=[],this.selectedEmployee=null}ngOnInit(){this.offboardForm=this.fb.group({effectiveDate:["",C.required],offboardingReason:["",C.required],clearanceStatus:["",C.required],certificationStatus:["",C.required],personalEmail:["",[C.required,C.email]],exitInterview:["",C.required],recommendation:["",C.required],recommendationComment:["",C.required]}),this.firestore.collection("employees").valueChanges({idField:"id"}).subscribe(n=>{this.employees=n.filter(r=>r.status!=="Offboarded")})}searchEmployees(){let n=this.searchQuery.toLowerCase();this.filteredEmployees=this.employees.filter(r=>r.id?.toString().includes(n)||r.lastname.toLowerCase().startsWith(n))}selectEmployee(n){this.selectedEmployee=n,this.searchQuery="",this.filteredEmployees=[],this.offboardForm.patchValue({personalEmail:n.personalEmail||""})}submitForm(){return v(this,null,function*(){if(!this.selectedEmployee){alert("\u274C Please select an employee first!");return}if(this.offboardForm.invalid){alert("\u26A0\uFE0F Please complete all required fields.");return}let n=de(ue({},this.offboardForm.value),{employeeId:this.selectedEmployee.id,employeeName:`${this.selectedEmployee.firstname} ${this.selectedEmployee.lastname}`,department:this.selectedEmployee.department||"Unknown",profileImageUrl:this.selectedEmployee.profileImageUrl||"",status:"Offboarded",timestamp:new Date});try{yield this.offboardService.saveOffboardingData(this.selectedEmployee.id,n),yield this.auditLogService.logAction("OFFBOARD_EMPLOYEE",`Employee ${this.selectedEmployee.firstname} ${this.selectedEmployee.lastname} was offboarded. Reason: ${n.offboardingReason}`,"Successful"),console.log("\u2705 Offboarding Successful!"),alert("\u2705 Offboarding details submitted successfully!"),this.offboardForm.reset(),this.selectedEmployee=null}catch(r){console.error("\u274C Offboarding Error:",r),alert("\u274C Error submitting offboarding details.")}})}static{this.\u0275fac=function(r){return new(r||e)(z(It),z(qt),z(W),z(Ft))}}static{this.\u0275cmp=nt({type:e,selectors:[["app-offboard"]],decls:81,vars:7,consts:[[1,"offboarding-container"],[1,"search-container"],["type","text","placeholder","Search by Last Name or Employee ID...",3,"ngModelChange","input","ngModel"],["class","search-results",4,"ngIf"],[3,"formGroup"],[1,"form-container"],[1,"section"],[1,"form-group"],["width","100","height","100",1,"user-icon","mx-auto",3,"src"],["type","text","readonly","",3,"value"],["type","date","formControlName","effectiveDate"],["formControlName","offboardingReason"],["value",""],["value","Resigned"],["value","Retired"],["value","Not Renewed"],["formControlName","clearanceStatus"],["value","Yes"],["value","No"],["formControlName","certificationStatus"],["type","email","formControlName","personalEmail","placeholder","Email@gmail.com"],["formControlName","exitInterview"],["value","Done"],["value","Pending"],["formControlName","recommendation"],["value","Rehire"],["value","Not Rehire"],["formControlName","recommendationComment","placeholder","Comment..."],[3,"click"],[1,"search-results"],[3,"click",4,"ngFor","ngForOf"]],template:function(r,i){r&1&&(h(0,"div",0)(1,"h4"),f(2,"Offboarding"),u(),h(3,"div",1)(4,"input",2),ft("ngModelChange",function(o){return ht(i.searchQuery,o)||(i.searchQuery=o),o}),he("input",function(){return i.searchEmployees()}),u(),Pe(5,xn,2,1,"ul",3),u(),h(6,"form",4)(7,"div",5)(8,"div",6)(9,"div",7),V(10,"img",8),h(11,"label"),f(12),u()(),h(13,"div",7)(14,"label"),f(15,"Employee ID:"),u(),V(16,"input",9),u(),h(17,"div",7)(18,"label"),f(19,"Effective Date Separated"),u(),V(20,"input",10),u(),h(21,"div",7)(22,"label"),f(23,"Reason for Offboarding"),u(),h(24,"select",11)(25,"option",12),f(26,"Select"),u(),h(27,"option",13),f(28,"Resigned"),u(),h(29,"option",14),f(30,"Retired"),u(),h(31,"option",15),f(32,"Not Renewed"),u()()(),h(33,"div",7)(34,"label"),f(35,"Clearance Form"),u(),h(36,"select",16)(37,"option",12),f(38,"Select"),u(),h(39,"option",17),f(40,"Yes"),u(),h(41,"option",18),f(42,"No"),u()()(),h(43,"div",7)(44,"label"),f(45,"Certifications"),u(),h(46,"select",19)(47,"option",12),f(48,"Select"),u(),h(49,"option",17),f(50,"Yes"),u(),h(51,"option",18),f(52,"No"),u()()()(),h(53,"div",6)(54,"div",7)(55,"label"),f(56,"Personal Email:"),u(),V(57,"input",20),u(),h(58,"div",7)(59,"label"),f(60,"Exit Interviews"),u(),h(61,"select",21)(62,"option",12),f(63,"Select"),u(),h(64,"option",22),f(65,"Done"),u(),h(66,"option",23),f(67,"Pending"),u()()(),h(68,"div",7)(69,"label"),f(70,"Recommendation"),u(),h(71,"select",24)(72,"option",12),f(73,"Select"),u(),h(74,"option",25),f(75,"Rehire"),u(),h(76,"option",26),f(77,"Not Rehire"),u()(),V(78,"textarea",27),u()()()(),h(79,"button",28),he("click",function(){return i.submitForm()}),f(80,"Submit"),u()()),r&2&&(M(4),dt("ngModel",i.searchQuery),M(),G("ngIf",i.searchQuery&&i.filteredEmployees.length>0),M(),G("formGroup",i.offboardForm),M(4),G("src",(i.selectedEmployee==null?null:i.selectedEmployee.profileImageUrl)||"picpro.jpg",at),M(2),ct("Name: ",(i.selectedEmployee==null?null:i.selectedEmployee.firstname)||""," ",(i.selectedEmployee==null?null:i.selectedEmployee.lastname)||"Not Selected",""),M(4),G("value",(i.selectedEmployee==null?null:i.selectedEmployee.id)||""))},dependencies:[pt,mt,Rt,kt,St,_t,Tt,gt,bt,yt,Et,wt],styles:[".offboarding-container[_ngcontent-%COMP%]{margin-left:250px;padding:40px}h4[_ngcontent-%COMP%]{font-size:45px;font-weight:700;border-bottom:2px solid #ddd;padding-bottom:35px}.search-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-bottom:20px}.search-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:8px;border:1px solid #ccc;border-radius:6px;font-size:16px;width:250px}.search-results[_ngcontent-%COMP%]{position:absolute;background:#fff;border:1px solid #ddd;border-radius:6px;width:250px;max-height:200px;overflow-y:auto}.search-results[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.search-results[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:8px;cursor:pointer}.search-results[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}.form-container[_ngcontent-%COMP%]{background:#fff;padding:30px;border-radius:8px;box-shadow:0 4px 10px #0000001a}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-bottom:15px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:12px;border:1px solid #ccc;border-radius:6px;font-size:16px}button[_ngcontent-%COMP%]{display:block;width:100%;padding:12px;background-color:#800020;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:18px}button[_ngcontent-%COMP%]:hover{background-color:#333}"]})}}return e})();var oi=(()=>{class e{constructor(n){this.firestore=n}saveEvaluation(n){return this.firestore.collection("evaluations").add(n)}getEvaluations(n){return this.firestore.collection("evaluations",r=>r.where("employeeId","==",n)).valueChanges()}getEmployeeEvaluations(n){return this.firestore.collection("evaluations",r=>r.where("employeeId","==",n).orderBy("date","desc")).valueChanges()}static{this.\u0275fac=function(r){return new(r||e)(S(W))}}static{this.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var li=(()=>{class e{constructor(){this.CLIENT_ID="578364808712-qpir6v204qs7gerc4bb086glo6s9vick.apps.googleusercontent.com",this.SCOPES="https://www.googleapis.com/auth/gmail.send",this.waitForGapiLoad().then(()=>this.initClient())}waitForGapiLoad(){return v(this,null,function*(){return new Promise(n=>{let r=setInterval(()=>{window.gapiLoaded&&gapi&&gapi.client&&(clearInterval(r),n())},500)})})}initClient(){return v(this,null,function*(){try{if(yield this.waitForGapiLoad(),!gapi||!gapi.client){console.error("\u274C gapi is not loaded properly.");return}yield gapi.client.init({clientId:this.CLIENT_ID,scope:this.SCOPES}),console.log("\u2705 Google API Initialized Successfully!")}catch(n){console.error("\u274C Error initializing Google API:",n)}})}sendEmail(n,r,i){return v(this,null,function*(){if(yield this.initClient(),!gapi.client||!gapi.client.gmail){console.error("\u274C Google API is not ready. Cannot send email.");return}let s=this.encodeEmail(n,r,i);try{let o=yield gapi.client.gmail.users.messages.send({userId:"me",resource:{raw:s}});console.log("\u{1F4E7} Email sent successfully:",o)}catch(o){console.error("\u274C Error sending email:",o)}})}encodeEmail(n,r,i){let s=`
      To: ${n}
      Subject: ${r}
      MIME-Version: 1.0
      Content-Type: text/html; charset=UTF-8

      ${i}
    `;return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Kt="firebasestorage.googleapis.com",Yt="storageBucket",On=2*60*1e3,Un=10*60*1e3,Cn=1e3;var g=class e extends xt{constructor(t,n,r=0){super(Le(t),`Firebase Storage: ${n} (${Le(t)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,e.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return Le(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},p=function(e){return e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment",e}(p||{});function Le(e){return"storage/"+e}function Ge(){let e="An unknown error occurred, please check the error payload for server response.";return new g(p.UNKNOWN,e)}function Pn(e){return new g(p.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist.")}function An(e){return new g(p.QUOTA_EXCEEDED,"Quota for bucket '"+e+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Nn(){let e="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new g(p.UNAUTHENTICATED,e)}function Dn(){return new g(p.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Mn(e){return new g(p.UNAUTHORIZED,"User does not have permission to access '"+e+"'.")}function Zt(){return new g(p.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Qt(){return new g(p.CANCELED,"User canceled the upload/download.")}function Ln(e){return new g(p.INVALID_URL,"Invalid URL '"+e+"'.")}function Fn(e){return new g(p.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function Bn(){return new g(p.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Yt+"' property when initializing the app?")}function Jt(){return new g(p.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function qn(){return new g(p.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function jn(){return new g(p.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function $n(e){return new g(p.UNSUPPORTED_ENVIRONMENT,`${e} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function q(e){return new g(p.INVALID_ARGUMENT,e)}function en(){return new g(p.APP_DELETED,"The Firebase app was deleted.")}function Ve(e){return new g(p.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function oe(e,t){return new g(p.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function se(e){throw new g(p.INTERNAL_ERROR,"Internal error: "+e)}var I=class e{constructor(t,n){this.bucket=t,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,n){let r;try{r=e.makeFromUrl(t,n)}catch{return new e(t,"")}if(r.path==="")return r;throw Fn(t)}static makeFromUrl(t,n){let r=null,i="([A-Za-z0-9.\\-_]+)";function s(E){E.path.charAt(E.path.length-1)==="/"&&(E.path_=E.path_.slice(0,-1))}let o="(/(.*))?$",l=new RegExp("^gs://"+i+o,"i"),a={bucket:1,path:3};function c(E){E.path_=decodeURIComponent(E.path)}let d="v[A-Za-z0-9_]+",b=n.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",_=new RegExp(`^https?://${b}/${d}/b/${i}/o${m}`,"i"),y={bucket:1,path:3},O=n===Kt?"(?:storage.googleapis.com|storage.cloud.google.com)":n,R="([^?#]*)",N=new RegExp(`^https?://${O}/${i}/${R}`,"i"),T=[{regex:l,indices:a,postModify:s},{regex:_,indices:y,postModify:c},{regex:N,indices:{bucket:1,path:2},postModify:c}];for(let E=0;E<T.length;E++){let $=T[E],H=$.regex.exec(t);if(H){let Ie=H[$.indices.bucket],ne=H[$.indices.path];ne||(ne=""),r=new e(Ie,ne),$.postModify(r);break}}if(r==null)throw Ln(t);return r}},Be=class{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}};function Hn(e,t,n){let r=1,i=null,s=null,o=!1,l=0;function a(){return l===2}let c=!1;function d(...R){c||(c=!0,t.apply(null,R))}function b(R){i=setTimeout(()=>{i=null,e(_,a())},R)}function m(){s&&clearTimeout(s)}function _(R,...N){if(c){m();return}if(R){m(),d.call(null,R,...N);return}if(a()||o){m(),d.call(null,R,...N);return}r<64&&(r*=2);let T;l===1?(l=2,T=0):T=(r+Math.random())*1e3,b(T)}let y=!1;function O(R){y||(y=!0,m(),!c&&(i!==null?(R||(l=2),clearTimeout(i),b(0)):R||(l=1)))}return b(0),s=setTimeout(()=>{o=!0,O(!0)},n),O}function zn(e){e(!1)}function Gn(e){return e!==void 0}function Vn(e){return typeof e=="function"}function Wn(e){return typeof e=="object"&&!Array.isArray(e)}function be(e){return typeof e=="string"||e instanceof String}function jt(e){return We()&&e instanceof Blob}function We(){return typeof Blob<"u"}function qe(e,t,n,r){if(r<t)throw q(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw q(`Invalid value for '${e}'. Expected ${n} or less.`)}function B(e,t,n){let r=t;return n==null&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function tn(e){let t=encodeURIComponent,n="?";for(let r in e)if(e.hasOwnProperty(r)){let i=t(r)+"="+t(e[r]);n=n+i+"&"}return n=n.slice(0,-1),n}var Y=function(e){return e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT",e}(Y||{});function nn(e,t){let n=e>=500&&e<600,i=[408,429].indexOf(e)!==-1,s=t.indexOf(e)!==-1;return n||i||s}var je=class{constructor(t,n,r,i,s,o,l,a,c,d,b,m=!0){this.url_=t,this.method_=n,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=l,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=d,this.connectionFactory_=b,this.retry=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((_,y)=>{this.resolve_=_,this.reject_=y,this.start_()})}start_(){let t=(r,i)=>{if(i){r(!1,new K(!1,null,!0));return}let s=this.connectionFactory_();this.pendingConnection_=s;let o=l=>{let a=l.loaded,c=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(a,c)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;let l=s.getErrorCode()===Y.NO_ERROR,a=s.getStatus();if(!l||nn(a,this.additionalRetryCodes_)&&this.retry){let d=s.getErrorCode()===Y.ABORT;r(!1,new K(!1,null,d));return}let c=this.successCodes_.indexOf(a)!==-1;r(!0,new K(c,s))})},n=(r,i)=>{let s=this.resolve_,o=this.reject_,l=i.connection;if(i.wasSuccessCode)try{let a=this.callback_(l,l.getResponse());Gn(a)?s(a):s()}catch(a){o(a)}else if(l!==null){let a=Ge();a.serverResponse=l.getErrorText(),this.errorCallback_?o(this.errorCallback_(l,a)):o(a)}else if(i.canceled){let a=this.appDelete_?en():Qt();o(a)}else{let a=Zt();o(a)}};this.canceled_?n(!1,new K(!1,null,!0)):this.backoffId_=Hn(t,n,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&zn(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},K=class{constructor(t,n,r){this.wasSuccessCode=t,this.connection=n,this.canceled=!!r}};function Xn(e,t){t!==null&&t.length>0&&(e.Authorization="Firebase "+t)}function Kn(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function Yn(e,t){t&&(e["X-Firebase-GMPID"]=t)}function Zn(e,t){t!==null&&(e["X-Firebase-AppCheck"]=t)}function Qn(e,t,n,r,i,s,o=!0){let l=tn(e.urlParams),a=e.url+l,c=Object.assign({},e.headers);return Yn(c,t),Xn(c,n),Kn(c,s),Zn(c,r),new je(a,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o)}function Jn(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function er(...e){let t=Jn();if(t!==void 0){let n=new t;for(let r=0;r<e.length;r++)n.append(e[r]);return n.getBlob()}else{if(We())return new Blob(e);throw new g(p.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function tr(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}function nr(e){if(typeof atob>"u")throw $n("base-64");return atob(e)}var x={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},ae=class{constructor(t,n){this.data=t,this.contentType=n||null}};function Xe(e,t){switch(e){case x.RAW:return new ae(rn(t));case x.BASE64:case x.BASE64URL:return new ae(sn(e,t));case x.DATA_URL:return new ae(ir(t),sr(t))}throw Ge()}function rn(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<e.length-1&&(e.charCodeAt(n+1)&64512)===56320))t.push(239,191,189);else{let s=r,o=e.charCodeAt(++n);r=65536|(s&1023)<<10|o&1023,t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(t)}function rr(e){let t;try{t=decodeURIComponent(e)}catch{throw oe(x.DATA_URL,"Malformed data URL.")}return rn(t)}function sn(e,t){switch(e){case x.BASE64:{let i=t.indexOf("-")!==-1,s=t.indexOf("_")!==-1;if(i||s)throw oe(e,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case x.BASE64URL:{let i=t.indexOf("+")!==-1,s=t.indexOf("/")!==-1;if(i||s)throw oe(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=nr(t)}catch(i){throw i.message.includes("polyfill")?i:oe(e,"Invalid character found")}let r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}var ge=class{constructor(t){this.base64=!1,this.contentType=null;let n=t.match(/^data:([^,]+)?,/);if(n===null)throw oe(x.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let r=n[1]||null;r!=null&&(this.base64=or(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=t.substring(t.indexOf(",")+1)}};function ir(e){let t=new ge(e);return t.base64?sn(x.BASE64,t.rest):rr(t.rest)}function sr(e){return new ge(e).contentType}function or(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}var Z=class e{constructor(t,n){let r=0,i="";jt(t)?(this.data_=t,r=t.size,i=t.type):t instanceof ArrayBuffer?(n?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),r=this.data_.length):t instanceof Uint8Array&&(n?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),r=t.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(t,n){if(jt(this.data_)){let r=this.data_,i=tr(r,t,n);return i===null?null:new e(i)}else{let r=new Uint8Array(this.data_.buffer,t,n-t);return new e(r,!0)}}static getBlob(...t){if(We()){let n=t.map(r=>r instanceof e?r.data_:r);return new e(er.apply(null,n))}else{let n=t.map(o=>be(o)?Xe(x.RAW,o).data:o.data_),r=0;n.forEach(o=>{r+=o.byteLength});let i=new Uint8Array(r),s=0;return n.forEach(o=>{for(let l=0;l<o.length;l++)i[s++]=o[l]}),new e(i,!0)}}uploadData(){return this.data_}};function Ke(e){let t;try{t=JSON.parse(e)}catch{return null}return Wn(t)?t:null}function ar(e){if(e.length===0)return null;let t=e.lastIndexOf("/");return t===-1?"":e.slice(0,t)}function lr(e,t){let n=t.split("/").filter(r=>r.length>0).join("/");return e.length===0?n:e+"/"+n}function on(e){let t=e.lastIndexOf("/",e.length-2);return t===-1?e:e.slice(t+1)}function cr(e,t){return t}var w=class{constructor(t,n,r,i){this.server=t,this.local=n||t,this.writable=!!r,this.xform=i||cr}},_e=null;function ur(e){return!be(e)||e.length<2?e:on(e)}function ye(){if(_e)return _e;let e=[];e.push(new w("bucket")),e.push(new w("generation")),e.push(new w("metageneration")),e.push(new w("name","fullPath",!0));function t(s,o){return ur(o)}let n=new w("name");n.xform=t,e.push(n);function r(s,o){return o!==void 0?Number(o):o}let i=new w("size");return i.xform=r,e.push(i),e.push(new w("timeCreated")),e.push(new w("updated")),e.push(new w("md5Hash",null,!0)),e.push(new w("cacheControl",null,!0)),e.push(new w("contentDisposition",null,!0)),e.push(new w("contentEncoding",null,!0)),e.push(new w("contentLanguage",null,!0)),e.push(new w("contentType",null,!0)),e.push(new w("metadata","customMetadata",!0)),_e=e,_e}function dr(e,t){function n(){let r=e.bucket,i=e.fullPath,s=new I(r,i);return t._makeStorageReference(s)}Object.defineProperty(e,"ref",{get:n})}function hr(e,t,n){let r={};r.type="file";let i=n.length;for(let s=0;s<i;s++){let o=n[s];r[o.local]=o.xform(r,t[o.server])}return dr(r,e),r}function an(e,t,n){let r=Ke(t);return r===null?null:hr(e,r,n)}function fr(e,t,n,r){let i=Ke(t);if(i===null||!be(i.downloadTokens))return null;let s=i.downloadTokens;if(s.length===0)return null;let o=encodeURIComponent;return s.split(",").map(c=>{let d=e.bucket,b=e.fullPath,m="/b/"+o(d)+"/o/"+o(b),_=B(m,n,r),y=tn({alt:"media",token:c});return _+y})[0]}function Ye(e,t){let n={},r=t.length;for(let i=0;i<r;i++){let s=t[i];s.writable&&(n[s.server]=e[s.local])}return JSON.stringify(n)}var $t="prefixes",Ht="items";function pr(e,t,n){let r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[$t])for(let i of n[$t]){let s=i.replace(/\/$/,""),o=e._makeStorageReference(new I(t,s));r.prefixes.push(o)}if(n[Ht])for(let i of n[Ht]){let s=e._makeStorageReference(new I(t,i.name));r.items.push(s)}return r}function mr(e,t,n){let r=Ke(n);return r===null?null:pr(e,t,r)}var U=class{constructor(t,n,r,i){this.url=t,this.method=n,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};function A(e){if(!e)throw Ge()}function Re(e,t){function n(r,i){let s=an(e,i,t);return A(s!==null),s}return n}function _r(e,t){function n(r,i){let s=mr(e,t,i);return A(s!==null),s}return n}function gr(e,t){function n(r,i){let s=an(e,i,t);return A(s!==null),fr(s,i,e.host,e._protocol)}return n}function ee(e){function t(n,r){let i;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?i=Dn():i=Nn():n.getStatus()===402?i=An(e.bucket):n.getStatus()===403?i=Mn(e.path):i=r,i.status=n.getStatus(),i.serverResponse=r.serverResponse,i}return t}function Ee(e){let t=ee(e);function n(r,i){let s=t(r,i);return r.getStatus()===404&&(s=Pn(e.path)),s.serverResponse=i.serverResponse,s}return n}function ln(e,t,n){let r=t.fullServerUrl(),i=B(r,e.host,e._protocol),s="GET",o=e.maxOperationRetryTime,l=new U(i,s,Re(e,n),o);return l.errorHandler=Ee(t),l}function br(e,t,n,r,i){let s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&n.length>0&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i);let o=t.bucketOnlyServerUrl(),l=B(o,e.host,e._protocol),a="GET",c=e.maxOperationRetryTime,d=new U(l,a,_r(e,t.bucket),c);return d.urlParams=s,d.errorHandler=ee(t),d}function yr(e,t,n){let r=t.fullServerUrl(),i=B(r,e.host,e._protocol),s="GET",o=e.maxOperationRetryTime,l=new U(i,s,gr(e,n),o);return l.errorHandler=Ee(t),l}function Rr(e,t,n,r){let i=t.fullServerUrl(),s=B(i,e.host,e._protocol),o="PATCH",l=Ye(n,r),a={"Content-Type":"application/json; charset=utf-8"},c=e.maxOperationRetryTime,d=new U(s,o,Re(e,r),c);return d.headers=a,d.body=l,d.errorHandler=Ee(t),d}function Er(e,t){let n=t.fullServerUrl(),r=B(n,e.host,e._protocol),i="DELETE",s=e.maxOperationRetryTime;function o(a,c){}let l=new U(r,i,o,s);return l.successCodes=[200,204],l.errorHandler=Ee(t),l}function wr(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}function cn(e,t,n){let r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=wr(null,t)),r}function Tr(e,t,n,r,i){let s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function l(){let T="";for(let E=0;E<2;E++)T=T+Math.random().toString().slice(2);return T}let a=l();o["Content-Type"]="multipart/related; boundary="+a;let c=cn(t,r,i),d=Ye(c,n),b="--"+a+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+d+`\r
--`+a+`\r
Content-Type: `+c.contentType+`\r
\r
`,m=`\r
--`+a+"--",_=Z.getBlob(b,r,m);if(_===null)throw Jt();let y={name:c.fullPath},O=B(s,e.host,e._protocol),R="POST",N=e.maxUploadRetryTime,D=new U(O,R,Re(e,n),N);return D.urlParams=y,D.headers=o,D.body=_.uploadData(),D.errorHandler=ee(t),D}var Q=class{constructor(t,n,r,i){this.current=t,this.total=n,this.finalized=!!r,this.metadata=i||null}};function Ze(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch{A(!1)}return A(!!n&&(t||["active"]).indexOf(n)!==-1),n}function kr(e,t,n,r,i){let s=t.bucketOnlyServerUrl(),o=cn(t,r,i),l={name:o.fullPath},a=B(s,e.host,e._protocol),c="POST",d={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},b=Ye(o,n),m=e.maxUploadRetryTime;function _(O){Ze(O);let R;try{R=O.getResponseHeader("X-Goog-Upload-URL")}catch{A(!1)}return A(be(R)),R}let y=new U(a,c,_,m);return y.urlParams=l,y.headers=d,y.body=b,y.errorHandler=ee(t),y}function Sr(e,t,n,r){let i={"X-Goog-Upload-Command":"query"};function s(c){let d=Ze(c,["active","final"]),b=null;try{b=c.getResponseHeader("X-Goog-Upload-Size-Received")}catch{A(!1)}b||A(!1);let m=Number(b);return A(!isNaN(m)),new Q(m,r.size(),d==="final")}let o="POST",l=e.maxUploadRetryTime,a=new U(n,o,s,l);return a.headers=i,a.errorHandler=ee(t),a}var zt=256*1024;function Ir(e,t,n,r,i,s,o,l){let a=new Q(0,0);if(o?(a.current=o.current,a.total=o.total):(a.current=0,a.total=r.size()),r.size()!==a.total)throw qn();let c=a.total-a.current,d=c;i>0&&(d=Math.min(d,i));let b=a.current,m=b+d,_="";d===0?_="finalize":c===d?_="upload, finalize":_="upload";let y={"X-Goog-Upload-Command":_,"X-Goog-Upload-Offset":`${a.current}`},O=r.slice(b,m);if(O===null)throw Jt();function R(E,$){let H=Ze(E,["active","final"]),Ie=a.current+d,ne=r.size(),ve;return H==="final"?ve=Re(t,s)(E,$):ve=null,new Q(Ie,ne,H==="final",ve)}let N="POST",D=t.maxUploadRetryTime,T=new U(n,N,R,D);return T.headers=y,T.body=O.uploadData(),T.progressCallback=l||null,T.errorHandler=ee(e),T}var un={STATE_CHANGED:"state_changed"},k={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Fe(e){switch(e){case"running":case"pausing":case"canceling":return k.RUNNING;case"paused":return k.PAUSED;case"success":return k.SUCCESS;case"canceled":return k.CANCELED;case"error":return k.ERROR;default:return k.ERROR}}var $e=class{constructor(t,n,r){if(Vn(t)||n!=null||r!=null)this.next=t,this.error=n??void 0,this.complete=r??void 0;else{let s=t;this.next=s.next,this.error=s.error,this.complete=s.complete}}};function X(e){return(...t)=>{Promise.resolve().then(()=>e(...t))}}var Gt=null,He=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Y.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Y.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Y.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,n,r,i){if(this.sent_)throw se("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(n,t,!0),i!==void 0)for(let s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw se("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw se("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw se("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw se("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}},ze=class extends He{initXhr(){this.xhr_.responseType="text"}};function P(){return Gt?Gt():new ze}var le=class{constructor(t,n,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=t,this._blob=n,this._metadata=r,this._mappings=ye(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{if(this._request=void 0,this._chunkMultiplier=1,i._codeEquals(p.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{let s=this.isExponentialBackoffExpired();if(nn(i.status,[]))if(s)i=Zt();else{this.sleepTime=Math.max(this.sleepTime*2,Cn),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=i,this._transition("error")}},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals(p.CANCELED)?this.completeTransitions_():(this._error=i,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((i,s)=>{this._resolve=i,this._reject=s,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){let t=this._transferred;return n=>this._updateProgress(t+n)}_shouldDoResumable(t){return t.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(t){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([n,r])=>{switch(this._state){case"running":t(n,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((t,n)=>{let r=kr(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,P,t,n);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){let t=this._uploadUrl;this._resolveToken((n,r)=>{let i=Sr(this._ref.storage,this._ref._location,t,this._blob),s=this._ref.storage._makeRequest(i,P,n,r);this._request=s,s.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){let t=zt*this._chunkMultiplier,n=new Q(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((i,s)=>{let o;try{o=Ir(this._ref._location,this._ref.storage,r,this._blob,t,this._mappings,n,this._makeProgressCallback())}catch(a){this._error=a,this._transition("error");return}let l=this._ref.storage._makeRequest(o,P,i,s,!1);this._request=l,l.getPromise().then(a=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(a.current),a.finalized?(this._metadata=a.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){zt*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((t,n)=>{let r=ln(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(r,P,t,n);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((t,n)=>{let r=Tr(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,P,t,n);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(t){let n=this._transferred;this._transferred=t,this._transferred!==n&&this._notifyObservers()}_transition(t){if(this._state!==t)switch(t){case"canceling":case"pausing":this._state=t,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":let n=this._state==="paused";this._state=t,n&&(this._notifyObservers(),this._start());break;case"paused":this._state=t,this._notifyObservers();break;case"canceled":this._error=Qt(),this._state=t,this._notifyObservers();break;case"error":this._state=t,this._notifyObservers();break;case"success":this._state=t,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){let t=Fe(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}}on(t,n,r,i){let s=new $e(n||void 0,r||void 0,i||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(t,n){return this._promise.then(t,n)}catch(t){return this.then(null,t)}_addObserver(t){this._observers.push(t),this._notifyObserver(t)}_removeObserver(t){let n=this._observers.indexOf(t);n!==-1&&this._observers.splice(n,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(n=>{this._notifyObserver(n)})}_finishPromise(){if(this._resolve!==void 0){let t=!0;switch(Fe(this._state)){case k.SUCCESS:X(this._resolve.bind(null,this.snapshot))();break;case k.CANCELED:case k.ERROR:let n=this._reject;X(n.bind(null,this._error))();break;default:t=!1;break}t&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(t){switch(Fe(this._state)){case k.RUNNING:case k.PAUSED:t.next&&X(t.next.bind(t,this.snapshot))();break;case k.SUCCESS:t.complete&&X(t.complete.bind(t))();break;case k.CANCELED:case k.ERROR:t.error&&X(t.error.bind(t,this._error))();break;default:t.error&&X(t.error.bind(t,this._error))()}}resume(){let t=this._state==="paused"||this._state==="pausing";return t&&this._transition("running"),t}pause(){let t=this._state==="running";return t&&this._transition("pausing"),t}cancel(){let t=this._state==="running"||this._state==="pausing";return t&&this._transition("canceling"),t}};var J=class e{constructor(t,n){this._service=t,n instanceof I?this._location=n:this._location=I.makeFromUrl(n,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,n){return new e(t,n)}get root(){let t=new I(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return on(this._location.path)}get storage(){return this._service}get parent(){let t=ar(this._location.path);if(t===null)return null;let n=new I(this._location.bucket,t);return new e(this._service,n)}_throwIfRoot(t){if(this._location.path==="")throw Ve(t)}};function vr(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new le(e,new Z(t),n)}function xr(e){let t={prefixes:[],items:[]};return dn(e,t).then(()=>t)}function dn(e,t,n){return v(this,null,function*(){let i=yield hn(e,{pageToken:n});t.prefixes.push(...i.prefixes),t.items.push(...i.items),i.nextPageToken!=null&&(yield dn(e,t,i.nextPageToken))})}function hn(e,t){t!=null&&typeof t.maxResults=="number"&&qe("options.maxResults",1,1e3,t.maxResults);let n=t||{},r=br(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(r,P)}function Or(e){e._throwIfRoot("getMetadata");let t=ln(e.storage,e._location,ye());return e.storage.makeRequestWithTokens(t,P)}function Ur(e,t){e._throwIfRoot("updateMetadata");let n=Rr(e.storage,e._location,t,ye());return e.storage.makeRequestWithTokens(n,P)}function Cr(e){e._throwIfRoot("getDownloadURL");let t=yr(e.storage,e._location,ye());return e.storage.makeRequestWithTokens(t,P).then(n=>{if(n===null)throw jn();return n})}function Pr(e){e._throwIfRoot("deleteObject");let t=Er(e.storage,e._location);return e.storage.makeRequestWithTokens(t,P)}function fn(e,t){let n=lr(e._location.path,t),r=new I(e._location.bucket,n);return new J(e.storage,r)}function Ar(e){return/^[A-Za-z]+:\/\//.test(e)}function Nr(e,t){return new J(e,t)}function pn(e,t){if(e instanceof ce){let n=e;if(n._bucket==null)throw Bn();let r=new J(n,n._bucket);return t!=null?pn(r,t):r}else return t!==void 0?fn(e,t):e}function Dr(e,t){if(t&&Ar(t)){if(e instanceof ce)return Nr(e,t);throw q("To use ref(service, url), the first argument must be a Storage instance.")}else return pn(e,t)}function Vt(e,t){let n=t?.[Yt];return n==null?null:I.makeFromBucketSpec(n,e)}function Mr(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";let{mockUserToken:i}=r;i&&(e._overrideAuthToken=typeof i=="string"?i:vt(i,e.app.options.projectId))}var ce=class{constructor(t,n,r,i,s){this.app=t,this._authProvider=n,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=Kt,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=On,this._maxUploadRetryTime=Un,this._requests=new Set,i!=null?this._bucket=I.makeFromBucketSpec(i,this._host):this._bucket=Vt(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=I.makeFromBucketSpec(this._url,t):this._bucket=Vt(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){qe("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){qe("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}_getAuthToken(){return v(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let t=this._authProvider.getImmediate({optional:!0});if(t){let n=yield t.getToken();if(n!==null)return n.accessToken}return null})}_getAppCheckToken(){return v(this,null,function*(){let t=this._appCheckProvider.getImmediate({optional:!0});return t?(yield t.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new J(this,t)}_makeRequest(t,n,r,i,s=!0){if(this._deleted)return new Be(en());{let o=Qn(t,this._appId,r,i,n,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(t,n){return v(this,null,function*(){let[r,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,n,r,i).getPromise()})}},Wt="@firebase/storage",Xt="0.13.2";var Lr="storage";function mn(e,t,n){return e=L(e),vr(e,t,n)}function _n(e){return e=L(e),Or(e)}function gn(e,t){return e=L(e),Ur(e,t)}function bn(e,t){return e=L(e),hn(e,t)}function yn(e){return e=L(e),xr(e)}function Rn(e){return e=L(e),Cr(e)}function En(e){return e=L(e),Pr(e)}function Qe(e,t){return e=L(e),Dr(e,t)}function wn(e,t){return fn(e,t)}function Tn(e,t,n,r={}){Mr(e,t,n,r)}function Fr(e,{instanceIdentifier:t}){let n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new ce(n,r,i,t,Ut)}function Br(){Ot(new fe(Lr,Fr,"PUBLIC").setMultipleInstances(!0)),Ne(Wt,Xt,""),Ne(Wt,Xt,"esm2017")}Br();var te=class{constructor(t,n,r){this._delegate=t,this.task=n,this.ref=r}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}};var we=class{constructor(t,n){this._delegate=t,this._ref=n,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new te(this._delegate.snapshot,this,this._ref)}then(t,n){return this._delegate.then(r=>{if(t)return t(new te(r,this,this._ref))},n)}on(t,n,r,i){let s;return n&&(typeof n=="function"?s=o=>n(new te(o,this,this._ref)):s={next:n.next?o=>n.next(new te(o,this,this._ref)):void 0,complete:n.complete||void 0,error:n.error||void 0}),this._delegate.on(t,s,r||void 0,i||void 0)}},Te=class{constructor(t,n){this._delegate=t,this._service=n}get prefixes(){return this._delegate.prefixes.map(t=>new j(t,this._service))}get items(){return this._delegate.items.map(t=>new j(t,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}};var j=class e{constructor(t,n){this._delegate=t,this.storage=n}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(t){let n=wn(this._delegate,t);return new e(n,this.storage)}get root(){return new e(this._delegate.root,this.storage)}get parent(){let t=this._delegate.parent;return t==null?null:new e(t,this.storage)}put(t,n){return this._throwIfRoot("put"),new we(mn(this._delegate,t,n),this)}putString(t,n=x.RAW,r){this._throwIfRoot("putString");let i=Xe(n,t),s=Object.assign({},r);return s.contentType==null&&i.contentType!=null&&(s.contentType=i.contentType),new we(new le(this._delegate,new Z(i.data,!0),s),this)}listAll(){return yn(this._delegate).then(t=>new Te(t,this.storage))}list(t){return bn(this._delegate,t||void 0).then(n=>new Te(n,this.storage))}getMetadata(){return _n(this._delegate)}updateMetadata(t){return gn(this._delegate,t)}getDownloadURL(){return Rn(this._delegate)}delete(){return this._throwIfRoot("delete"),En(this._delegate)}_throwIfRoot(t){if(this._delegate._location.path==="")throw Ve(t)}};var ke=class{constructor(t,n){this.app=t,this._delegate=n}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(t){if(kn(t))throw q("ref() expected a child path but got a URL, use refFromURL instead.");return new j(Qe(this._delegate,t),this)}refFromURL(t){if(!kn(t))throw q("refFromURL() expected a full URL but got a child path, use ref() instead.");try{I.makeFromUrl(t,this._delegate.host)}catch{throw q("refFromUrl() expected a valid full URL but got an invalid one.")}return new j(Qe(this._delegate,t),this)}setMaxUploadRetryTime(t){this._delegate.maxUploadRetryTime=t}setMaxOperationRetryTime(t){this._delegate.maxOperationRetryTime=t}useEmulator(t,n,r={}){Tn(this._delegate,t,n,r)}};function kn(e){return/^[A-Za-z]+:\/\//.test(e)}var qr="@firebase/storage-compat",jr="0.3.12";var $r="storage-compat";function Hr(e,{instanceIdentifier:t}){let n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("storage").getImmediate({identifier:t});return new ke(n,r)}function zr(e){let t={TaskState:k,TaskEvent:un,StringFormat:x,Storage:ke,Reference:j};e.INTERNAL.registerComponent(new fe($r,Hr,"PUBLIC").setServiceProps(t).setMultipleInstances(!0)),e.registerVersion(qr,jr)}zr(pe);function Gr(e){return new Je(t=>{let n=o=>t.next(o),r=o=>t.error(o),i=()=>t.complete();n(e.snapshot);let s=e.on("state_changed",n);return e.then(o=>{n(o),i()},o=>{n(e.snapshot),r(o)}),function(){s()}}).pipe(tt(0))}function Sn(e){let t=Gr(e);return{task:e,then:e.then.bind(e),catch:e.catch.bind(e),pause:e.pause.bind(e),cancel:e.cancel.bind(e),resume:e.resume.bind(e),snapshotChanges:()=>t,percentageChanges:()=>t.pipe(et(n=>n.bytesTransferred/n.totalBytes*100))}}function Se(e){return{getDownloadURL:()=>xe(void 0).pipe(De,Oe(()=>e.getDownloadURL()),Me),getMetadata:()=>xe(void 0).pipe(De,Oe(()=>e.getMetadata()),Me),delete:()=>re(e.delete()),child:t=>Se(e.child(t)),updateMetadata:t=>re(e.updateMetadata(t)),put:(t,n)=>{let r=e.put(t,n);return Sn(r)},putString:(t,n,r)=>{let i=e.putString(t,n,r);return Sn(i)},list:t=>re(e.list(t)),listAll:()=>re(e.listAll())}}var Vr=new ie("angularfire2.storageBucket"),Wr=new ie("angularfire2.storage.maxUploadRetryTime"),Xr=new ie("angularfire2.storage.maxOperationRetryTime"),Kr=new ie("angularfire2.storage.use-emulator"),Yr=(()=>{class e{storage;constructor(n,r,i,s,o,l,a,c,d,b){let m=Mt(n,o,r);this.storage=Lt(`${m.name}.storage.${i}`,"AngularFireStorage",m.name,()=>{let _=o.runOutsideAngular(()=>m.storage(i||void 0)),y=d;return y&&_.useEmulator(...y),a&&_.setMaxUploadRetryTime(a),c&&_.setMaxOperationRetryTime(c),_},[a,c])}ref(n){return Se(this.storage.ref(n))}refFromURL(n){return Se(this.storage.refFromURL(n))}upload(n,r,i){let s=this.storage.ref(n);return Se(s).put(r,i)}static \u0275fac=function(r){return new(r||e)(S(Nt),S(Dt,8),S(Vr,8),S(ot),S(st),S(At),S(Wr,8),S(Xr,8),S(Kr,8),S(Pt,8))};static \u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"any"})}return e})();var Zr=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=Ce({type:e});static \u0275inj=Ue({})}return e})(),Hi=(()=>{class e{constructor(){pe.registerVersion("angularfire",Ct.full,"gcs-compat")}static \u0275fac=function(r){return new(r||e)};static \u0275mod=Ce({type:e});static \u0275inj=Ue({providers:[Yr],imports:[Zr]})}return e})();export{qt as a,ri as b,oi as c,Yr as d,Hi as e,li as f};
